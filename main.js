(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",t)}e.d({},{hz:()=>d,vi:()=>L,ZQ:()=>k});var r=document.querySelector(".confirmation-popup"),c=r.querySelector(".popup__button");var a=function(e,t,o){var c=function(e,t){var o,c,a=document.querySelector("#elements__item").content.querySelector(".elements__item").cloneNode(!0),i=d.querySelector(".popup__caption"),l=a.querySelector(".elements__place"),s=a.querySelector(".elements__image"),p=a.querySelector(".elements__counter"),f=a.querySelector(".elements__button");return s.src=e.link,s.alt=e.name,s.addEventListener("click",(function(){n(d),L.src=e.link,L.alt=e.name,i.textContent=e.name})),l.textContent=e.name,e.likes.forEach((function(e){"b2364691aa0aca61f977c54e"==e._id&&f.classList.add("elements__button_active")})),p.textContent=e.likes.length,function(e,t){e.addEventListener("click",(function(){var n=e.nextElementSibling;2==e.classList.length?fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"bd0a4522-502b-47b6-9943-4c4f37572342"}}).then((function(e){return e.json()})).then((function(e){return u(n,e.likes.length)})):fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"bd0a4522-502b-47b6-9943-4c4f37572342"}}).then((function(e){return e.json()})).then((function(e){return u(n,e.likes.length)})),e.classList.toggle("elements__button_active")}))}(f,e._id),t?(o=a.querySelector(".elements__delete-button"),c=e._id,o.addEventListener("click",(function(){o.classList.add("to-delete"),o.classList.add("".concat(c)),n(r)}))):a.querySelector(".elements__delete-button").classList.add("elements__delete-button_inactive"),a}(e,o);t?k.append(c):k.prepend(c)};function u(e,t){e.textContent=t}c.addEventListener("click",(function(){var e=document.querySelector(".to-delete");e.classList.remove("to-delete"),fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/".concat(e.classList[1]),{method:"DELETE",headers:{authorization:"bd0a4522-502b-47b6-9943-4c4f37572342"}}),e.closest(".elements__item").remove(),o(document.querySelector(".popup_opened"))}));var i=function(e,t){s(e)?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled","disabled")},l=function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)},s=function(e){return e.some((function(e){return!e.validity.valid}))},p={baseUrl:"https://nomoreparties.co/v1/exp-mipt-fbc-1",headers:{authorization:"bd0a4522-502b-47b6-9943-4c4f37572342","Content-Type":"application/json"}},d=document.querySelector(".image-popup"),f=document.querySelector(".card-popup"),m=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),v=document.querySelector(".profile-popup"),y=v.querySelector(".popup__form"),h=v.querySelector('input[name="name"]'),b=document.querySelector(".profile"),S=b.querySelector(".profile__name"),q=v.querySelector('input[name="description"]'),E=b.querySelector(".profile__description"),L=d.querySelector(".popup__image"),k=document.querySelector(".elements"),C=b.querySelector(".profile__avatar"),g=b.querySelector(".profile__edit-overlay"),x=document.querySelector(".avatar-popup"),A=x.querySelector(".popup__form"),j=A.querySelector(".popup__input"),z=x.querySelector(".popup__button"),P=f.querySelector('input[name="name"]'),O=f.querySelector('input[name="description"]'),T=f.querySelector(".popup__form"),U=f.querySelector(".popup__button"),w=Array.from(y.querySelectorAll(".popup__input")),N=(Array.from(T.querySelectorAll(".popup__input")),y.querySelector(".popup__button")),D=Array.from(document.querySelectorAll(".popup__overlay")),J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_error",errorClass:"popup__form-error_active"};D.forEach((function(e){e.addEventListener("click",(function(){o(e.closest(".popup"))}))}));var B,H={save:["Сохранить","Сохранение..."],create:["Создать","Создание..."]};function M(e,t,n){t.textContent=e?H[n][1]:H[n][0]}m.addEventListener("click",(function(){h.value=S.textContent,q.value=E.textContent,w.forEach((function(e){l(y,e,J),i(w,N)})),n(v)})),document.querySelectorAll(".popup__close-icon").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return o(t)}))})),y.addEventListener("submit",(function(){var e,t;S.textContent=h.value,E.textContent=q.value,M(!0,z,"save"),(e=h.value,t=q.value,fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:p.headers,body:JSON.stringify({name:e,about:t})})).finally((function(){return M(!1,z,"save")})).catch((function(e){console.log(e)})),o(v)})),g.addEventListener("click",(function(){n(x)})),A.addEventListener("submit",(function(){var e;C.src=j.value,M(!0,N,"save"),(e=j.value,fetch("".concat(p.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:e})})).finally((function(){return M(!1,N,"save")})).catch((function(e){console.log(e)})),o(x)})),fetch("".concat(p.baseUrl,"/cards"),{headers:{authorization:p.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){"b2364691aa0aca61f977c54e"==e.owner._id?a(e,!0,!0):a(e,!0,!1)}))})).catch((function(e){console.log(e)})),_.addEventListener("click",(function(){U.setAttribute("disabled","disabled"),n(f)})),T.addEventListener("submit",(function(e){var t=P.value,n=O.value;M(!0,U,"create"),function(e,t){return fetch("".concat(p.baseUrl,"/cards"),{method:"POST",headers:p.headers,body:JSON.stringify({name:e,link:t})})}(t,n).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return a({name:t,link:n,_id:e._id,likes:e.likes},!1,!0)})).finally((function(){return M(!1,U,"create")})).catch((function(e){console.log(e)})),o(f),e.target.reset()})),B=J,Array.from(document.querySelectorAll(B.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o),n.forEach((function(r){r.addEventListener("input",(function(){l(e,r,t),i(n,o)}))}))}(e,B)})),fetch("".concat(p.baseUrl,"/users/me"),{headers:{authorization:p.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return function(e){S.textContent=e.name,E.textContent=e.about,C.src=e.avatar}(e)})).catch((function(e){console.log(e)}))})();